import{c as Y,r as f,a as C,w as _,a0 as le,a1 as ie,e as ue,o as Z,p as ce,h as b,t as ee,l as de,a2 as x,f as G,y as H,a3 as N,x as fe,a4 as W,a5 as ge,j as te,a6 as oe,a7 as me,a8 as he,g as ve,a9 as ae,Q as v,aa as ye,_ as be,D as pe,E as we,F as Se,G as g,ab as S,L as Q,J as d,I as h,ac as ke,ad as A,ae as _e,H as q,af as qe,ag as Ce,ah as O,ai as R,aj as Be,ak as Pe,al as j,am as Ie,an as $e,ao as De,ap as Qe}from"./index.5a406c09.js";import{Q as J}from"./QSpace.400413d1.js";import{Q as Ae}from"./QBar.460fbde9.js";import{Q as Le,a as Ve,b as xe}from"./QChip.18380f88.js";import{Q as Ee,a as Te}from"./QItemSection.402d9bf2.js";import{Q as ze}from"./QBtnGroup.b86a7273.js";import{Q as Me}from"./QBadge.9b5dac9c.js";import{C as He}from"./ClosePopup.4049bd58.js";import{P as Ne}from"./ProductInfo.60daef80.js";import{a as K}from"./axios.37d53be1.js";import{c as X}from"./index.72c2906b.js";import"./selection.be2c882b.js";import"./QImg.c9036d02.js";import"./QToolbarTitle.f25dd7b5.js";import"./QToolbar.6a6430ac.js";const{passive:k}=de;var Oe=Y({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(e,{slots:t,emit:s}){const n=f(!1),a=f(!0),i=f(null),y=f(null);let l=e.initialIndex||0,o,u;const L=C(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function p(){if(e.disable===!0||n.value===!0||a.value===!1)return;const c=x(o),m=H(o),D=W(o);e.reverse===!1?Math.round(m+D+e.offset)>=Math.round(c)&&B():Math.round(m)<=e.offset&&B()}function B(){if(e.disable===!0||n.value===!0||a.value===!1)return;l++,n.value=!0;const c=x(o);s("load",l,m=>{a.value===!0&&(n.value=!1,G(()=>{if(e.reverse===!0){const D=x(o),se=H(o),ne=D-c;N(o,se+ne)}m===!0?P():i.value&&i.value.closest("body")&&u()}))})}function T(){l=0}function V(){a.value===!1&&(a.value=!0,o.addEventListener("scroll",u,k)),p()}function P(){a.value===!0&&(a.value=!1,n.value=!1,o.removeEventListener("scroll",u,k),u!==void 0&&u.cancel!==void 0&&u.cancel())}function I(){if(o&&a.value===!0&&o.removeEventListener("scroll",u,k),o=fe(i.value,e.scrollTarget),a.value===!0){if(o.addEventListener("scroll",u,k),e.reverse===!0){const c=x(o),m=W(o);N(o,c-m)}p()}}function z(c){l=c}function $(c){c=parseInt(c,10);const m=u;u=c<=0?p:ge(p,isNaN(c)===!0?100:c),o&&a.value===!0&&(m!==void 0&&o.removeEventListener("scroll",m,k),o.addEventListener("scroll",u,k))}function w(c){if(r.value===!0){if(y.value===null){c!==!0&&G(()=>{w(!0)});return}const m=`${n.value===!0?"un":""}pauseAnimations`;Array.from(y.value.getElementsByTagName("svg")).forEach(D=>{D[m]()})}}const r=C(()=>e.disable!==!0&&a.value===!0);_([n,r],()=>{w()}),_(()=>e.disable,c=>{c===!0?P():V()}),_(()=>e.reverse,()=>{n.value===!1&&a.value===!0&&p()}),_(()=>e.scrollTarget,I),_(()=>e.debounce,$);let M=!1;le(()=>{M!==!1&&o&&N(o,M)}),ie(()=>{M=o?H(o):!1}),ue(()=>{a.value===!0&&o.removeEventListener("scroll",u,k)}),Z(()=>{$(e.debounce),I(),n.value===!1&&w()});const re=te();return Object.assign(re.proxy,{poll:()=>{u!==void 0&&u()},trigger:B,stop:P,reset:T,resume:V,setIndex:z,updateScrollTarget:I}),()=>{const c=ce(t.default,[]);return r.value===!0&&c[e.reverse===!1?"push":"unshift"](b("div",{ref:y,class:L.value},ee(t.loading))),b("div",{class:"q-infinite-scroll",ref:i},c)}}});const Re=Object.keys(oe);function je(e){return Re.reduce((t,s)=>{const n=e[s];return n!==void 0&&(t[s]=n),t},{})}var Ue=Y({name:"QBtnDropdown",props:{...oe,...me,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:s}){const{proxy:n}=te(),a=f(e.modelValue),i=f(null),y=he(),l=C(()=>{const r={"aria-expanded":a.value===!0?"true":"false","aria-haspopup":"true","aria-controls":y.value,"aria-label":e.toggleAriaLabel||n.$q.lang.label[a.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(r["aria-disabled"]="true"),r}),o=C(()=>"q-btn-dropdown__arrow"+(a.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),u=C(()=>ve(e)),L=C(()=>je(e));_(()=>e.modelValue,r=>{i.value!==null&&i.value[r?"show":"hide"]()}),_(()=>e.split,w);function p(r){a.value=!0,s("beforeShow",r)}function B(r){s("show",r),s("update:modelValue",!0)}function T(r){a.value=!1,s("beforeHide",r)}function V(r){s("hide",r),s("update:modelValue",!1)}function P(r){s("click",r)}function I(r){ye(r),w(),s("click",r)}function z(r){i.value!==null&&i.value.toggle(r)}function $(r){i.value!==null&&i.value.show(r)}function w(r){i.value!==null&&i.value.hide(r)}return Object.assign(n,{show:$,hide:w,toggle:z}),Z(()=>{e.modelValue===!0&&$()}),()=>{const r=[b(ae,{class:o.value,name:e.dropdownIcon||n.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&r.push(b(Le,{ref:i,id:y.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:p,onShow:B,onBeforeHide:T,onHide:V},t.default)),e.split===!1?b(v,{class:"q-btn-dropdown q-btn-dropdown--simple",...L.value,...l.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:P},{default:()=>ee(t.label,[]).concat(r),loading:t.loading}):b(ze,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...u.value,glossy:e.glossy,stretch:e.stretch},()=>[b(v,{class:"q-btn-dropdown--current",...L.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:I},{default:t.label,loading:t.loading}),b(v,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...l.value,...u.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>r)])}}});const{offset:E}=Be,{getScrollTarget:U,setVerticalScrollPosition:F}=Pe,Fe=pe({name:"ProductList",components:{ProductInfo:Ne},data:function(){return{showing_products:[]}},watch:{products(e){e&&e.length>0&&this.showing_products.length===0&&(this.showing_products=e.slice(0,Math.max(24,this.showing_products.length)),this.page=1)}},methods:{go_prev_category(){var e=this.category[0].category,t=0,s=-9999;this.category.forEach(i=>{E(document.querySelector("."+i.category)).top<0&&(t=E(document.querySelector("."+i.category)).top,t>s&&(s=t,e=i.category))});let n=U(document.querySelector("."+e));const a=300;F(n,document.querySelector("."+e).offsetTop-50,a)},go_next_category(){var e,t=0,s=9999;this.category.forEach(i=>{E(document.querySelector("."+i.category)).top>100&&(t=E(document.querySelector("."+i.category)).top,t<s&&(s=t,e=i.category))});let n=U(document.querySelector("."+e));const a=300;F(n,document.querySelector("."+e).offsetTop-50,a)},handleScroll(e){let t=document.querySelector("."+e),s=U(t),n=t.offsetTop-50;F(s,n,300)},setproductbuyoption(e,t){e.buyoption=t},async products_update(e,t){if(this.products.length===0){t();return}const s=this.showing_products.length,n=this.products.slice(s,s+24);if(n.length===0){this.hasMore=!1,t(!0);return}this.showing_products.push(...n),t()}},computed:{...we({checkoutStatus:e=>e.cart.checkoutStatus,category:e=>e.category.items,products:e=>e.products.all,storeversion:e=>e.products.version,products_status:e=>e.products.status,selected_local:e=>e.ui_local.status})},mounted(){this.products&&this.products.length>0&&(this.showing_products=this.products.slice(0,Math.max(24,this.showing_products.length))),K.get(`${X.server}/storeVersion`).then(e=>{const t=parseInt(e.data.results),s=parseInt(this.storeversion);if(console.log("\uD0C0\uC785 \uD655\uC778:",typeof t,typeof s),console.log(t>s),t>s||this.products.length===0){this.showing_products=[],this.$store.dispatch("category/resetStoreAction"),this.$store.dispatch("products/emptyStoreAction"),this.$store.dispatch("products/getVersionAction",t);const n={list_index_min:0,list_index_max:2e4};try{K({url:`${X.server}/productList`,method:"GET",params:n}).then(a=>{a.data.results.length>0?a.data.results.map(i=>{this.$store.dispatch("products/getProductAction",i)}):console.log("error: \uC5C5\uB370\uC774\uD2B8 \uBC1B\uC744 \uC0C1\uD488\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")}).catch(a=>{a.response?a.response.status===400?console.error("Error 400: Bad Request. Check your request parameters (params).",a.response.data):console.error(`Error ${a.response.status}:`,a.response.data):a.request?console.error("No response received from the server. Please check your network connection."):console.error("Error during request setup:",a.message)})}catch(a){console.error("Error fetching products:",a)}}else console.log("\uC774\uBBF8 \uBAA8\uB4E0 \uC0C1\uD488\uC744 \uAC00\uC838\uC654\uC2B5\uB2C8\uB2E4.")}).catch(e=>{console.error("Error fetching products:",e)})},setup(){const e=f(null),t=f(!0);return{childbuyoption:f("one"),keyword:f(""),event_fab:f(!1),visible:f(!0),showSimulatedReturnData:f(!1),list_col_number:f(4),searchDialog:f(!1),page:f(0),infiniteScroll:e,hasMore:t}}}),Ge={class:"fixed-top-right z-top q-ma-xs row q-gutter-sm"},We={class:"text-h2"},Je={class:"text-orange text-bold row justify-center"},Ke={key:0},Xe={key:1,class:"text-positive"};function Ye(e,t,s,n,a,i){const y=Se("ProductInfo");return g(),S("div",null,[Q("div",Ge,[d(v,{icon:"search",size:"12px",flat:"",outline:"",onClick:t[0]||(t[0]=l=>e.searchDialog=!0)})]),d(Ce,{class:"z-max",modelValue:e.searchDialog,"onUpdate:modelValue":t[4]||(t[4]=l=>e.searchDialog=l),position:"top"},{default:h(()=>[d(ke,{style:{width:"100%"}},{default:h(()=>[Q("div",We,A(e.selected_local.chinafood=="\u6D3D\u6D3D\u4E2D\u56FD\u98DF\u54C1"?"\u5546\u54C1\u641C\u7D22":"\uC0C1\uD488\uAC80\uC0C9"),1),d(J),d(v,{class:"absolute-top-right",flat:"",size:"20px",icon:"close",onClick:t[1]||(t[1]=l=>e.searchDialog=!1)}),d(_e,{class:"q-pa-sm","input-class":" text-black",outlined:"",rounded:"",modelValue:e.keyword,"onUpdate:modelValue":t[3]||(t[3]=l=>e.keyword=l),"label-color":"dark",label:e.selected_local.search},{append:h(()=>[e.keyword!==""?(g(),q(ae,{key:0,name:"close",onClick:t[2]||(t[2]=l=>e.keyword=""),class:"cursor-pointer"})):qe("",!0)]),_:1},8,["modelValue","label"])]),_:1})]),_:1},8,["modelValue"]),Q("div",null,[d(Oe,{onLoad:e.products_update,offset:500,ref:"infiniteScroll"},{default:h(()=>[(g(!0),S(O,null,R(e.category,l=>(g(),S("div",j({class:"row",key:l.category},l),[d(Ae,{dense:"",class:"col-12 bg-dark text-white"},{default:h(()=>[Q("div",{class:Ie(l.category)},A(l.category),3),d(J)]),_:2},1024),d($e),(g(!0),S(O,null,R(e.showing_products.filter(o=>o.category==l.category&&o.stored==1&&(o.tag+o.category+o.keyword).toLowerCase().includes(e.keyword.toLowerCase())),o=>(g(),q(y,j({class:[e.list_col_number==3?"col-3":e.list_col_number==4?"col-4":"col-12","q-pa-xs"],key:o.product_id},o,{colNumber:e.list_col_number,onSetbuyoption:u=>o.buyoption=u,onSetquantity:u=>o.quantity=u,onSendOrderItem:u=>this.$store.dispatch("cart/addProductToCart",o),onSendRemoveItem:u=>this.$store.dispatch("cart/removeProductFromCart",o)}),null,16,["class","colNumber","onSetbuyoption","onSetquantity","onSendOrderItem","onSendRemoveItem"]))),128))],16))),128))]),_:1},8,["onLoad"]),Q("div",Je,[e.hasMore?(g(),S("div",Ke,A(e.selected_local.chinafood=="\u6D3D\u6D3D\u4E2D\u56FD\u98DF\u54C1"?"\u4E0B\u5212\u66F4\u65B0\u66F4\u591A\u5546\u54C1":"\uC2A4\uD06C\uB864\uD558\uC5EC \uB354 \uB9CE\uC740 \uC0C1\uD488\uC744 \uBD88\uB7EC\uC624\uC138\uC694"),1)):(g(),S("div",Xe,A(e.selected_local.chinafood=="\u6D3D\u6D3D\u4E2D\u56FD\u98DF\u54C1"?"\u5546\u54C1\u66F4\u65B0\u5B8C\u6BD5":"\uC0C1\uD488\uC744 \uBAA8\uB450 \uBD88\uB7EC\uC654\uC2B5\uB2C8\uB2E4."),1))])]),d(Me,{class:"column q-gutter-md",style:{width:"30px"},position:"bottom-right",offset:[60,10]},{default:h(()=>[e.list_col_number==4?(g(),q(v,{key:0,class:"row",color:"dark",size:"20px",onClick:t[5]||(t[5]=l=>e.list_col_number=3),icon:"zoom_in_map",round:""})):(g(),q(v,{key:1,class:"row",color:"dark",size:"20px",onClick:t[6]||(t[6]=l=>e.list_col_number=4),icon:"zoom_out_map",round:""})),d(Ue,{class:"row",color:"dark",size:"16px","dropdown-icon":"keyboard_arrow_left",rounded:""},{default:h(()=>[(g(!0),S(O,null,R(e.category.slice().sort(),l=>(g(),q(Ve,j({key:l.category},l,{dense:"",padding:"xs",color:"dark"}),{default:h(()=>[De((g(),q(Ee,{clickable:"",onClick:o=>e.handleScroll(l.category)},{default:h(()=>[d(Te,null,{default:h(()=>[d(xe,{class:"dark"},{default:h(()=>[Qe(A(l.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[He]])]),_:2},1040))),128))]),_:1}),d(v,{icon:"keyboard_arrow_up",size:"20px",class:"row bg-dark text-white",round:"",onClick:t[7]||(t[7]=l=>e.go_prev_category())}),d(v,{icon:"keyboard_arrow_down",size:"20px",class:"row bg-dark text-white",round:"",onClick:t[8]||(t[8]=l=>e.go_next_category())})]),_:1})])}var mt=be(Fe,[["render",Ye]]);export{mt as default};

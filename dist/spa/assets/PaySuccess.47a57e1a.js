import{_ as d,B as u,a$ as l,bo as c,C as h,E as p,F as _,G as m,Z as n,H as f,Q as y}from"./index.4b4a7f1d.js";import{Q as g}from"./QPage.f3c414a8.js";import{a}from"./axios.37d53be1.js";import{c as r}from"./index.72c2906b.js";import{a as i}from"./alert.26ffd408.js";const P=u({name:"PaySuccess",mounted(){this.paymentAuthorizationRequest()},data(){return{postJsonData:[{paymentkey:"",amount:0,orderId:""}]}},computed:{...l("cart",{cartItems:"getCartItems",cartTotalPrice:"cartTotalPrice",cartProducts:"cartProducts",shipment:"shipmentPrice",freeze_shipment:"freeze_shipmentPrice"}),...c("cart",["checkout"]),...c("coupon",["setStatusAction",""]),...h({user:t=>t.user.USER,addressList:t=>t.address.items,selected_local:t=>t.ui_local.status,couponList:t=>t.coupon.items,coupon_status:t=>t.coupon.status,deliveryFee:t=>t.cart.deliveryFee})},methods:{readResData(){let t=new URL(window.location.href);this.postJsonData={paymentKey:t.searchParams.get("paymentKey"),amount:t.searchParams.get("amount"),orderId:t.searchParams.get("orderId")}},paymentAuthorizationRequest(){this.readResData();const t=this.postJsonData;var e=this.cartTotalPrice+this.shipment+this.freeze_shipment-this.deliveryFee;console.log("\uAC00\uACA9 \uBE44\uAD50: "+e+"\uBD88\uB7EC\uC628 \uAC00\uACA9: "+t.amount),a({url:"https://api.tosspayments.com/v1/payments/confirm",method:"POST",headers:{"Access-Control-Allow-Headers":"*","Content-Type":"application/json",authorization:`Basic ${r.secretKey}`},data:t}).then(async s=>{s.status==200?(this.cartTotalPrice>=5e4&&this.get_eventCoupon(),this.set_order_with_address(await this.get_address_id())):console.log("\uACB0\uC81C\uC624\uB958 \uB0AC\uC73C\uBA74 PayFail \uD398\uC774\uC9C0\uB85C \uC774\uB3D9\uD574\uC57C \uD558\uC9C0 \uC54A\uB098?")}).catch(s=>{i.confirm(this.selected_local.err,JSON.stringify(s)),console.error(s)})},set_order_with_address(t){var e=this.couponList.find(o=>o.coupon_use_reserve==1);const s={user_id:this.user.USER_ID,address_id:t,order_data:this.cartItems,food_price:this.cartTotalPrice,total_price:this.postJsonData.amount,used_coupon_id:e==null?null:e.coupon_id};console.log(JSON.stringify(s.order_data)),a({url:`${r.server}/orderRegister`,method:"POST",headers:{"Access-Control-Allow-Headers":"*","Content-Type":"application/json",authorization:this.user.USER_TOKEN},data:s}).then(o=>{o.status==200&&(this.$store.dispatch("cart/checkout"),this.$store.dispatch("coupon/setStatusAction","buy complete"),this.$store.dispatch("order/setStatusAction","buy complete"),this.read_coupon())}).catch(o=>console.log("\uC5D0\uB7EC: "+o))},read_coupon(){this.coupon_status!=null&&a({url:`${r.server}/mycoupon`,method:"POST",headers:{"Access-Control-Allow-Headers":"*","Content-Type":"application/json",authorization:this.user.USER_TOKEN},data:{user_id:this.user.USER_ID,user_name:this.user.USER_NAME}}).then(t=>{t.status==200?(this.$store.dispatch("coupon/emptyCouponAction"),t.data.results.length>0&&t.data.results.forEach(e=>{e.available===1&&this.$store.dispatch("coupon/addCouponAction",e)}),this.$store.dispatch("coupon/setStatusAction",null)):i.confirm(this.selected_local.err,this.selected_local.err+": "+t.data.content)}).catch(t=>{console.log("\uC5D0\uB7EC:"+t)})},get_eventCoupon(){const t={user_id:this.user.USER_ID,food_price:this.cartTotalPrice};a({url:`${r.server}/giveCoupon`,method:"POST",headers:{"Access-Control-Allow-Headers":"*","Content-Type":"application/json",authorization:this.user.USER_TOKEN},data:t}).then(e=>{e.status==200&&i.confirm("50000\uC6D0 \uAD6C\uB9E4 \uAC10\uC0AC \uC774\uBCA4\uD2B8","50000\uC6D0 \uC774\uC0C1 \uAD6C\uB9E4\uD558\uC154\uC11C 3000\uC6D0 \uCFE0\uD3F0\uC774 \uC9C0\uAE09\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC0AC\uC6A9\uAE30\uD55C\uC740 3\uAC1C\uC6D4\uC785\uB2C8\uB2E4. 3\uAC1C\uC6D4 \uC774\uB0B4\uC5D0 \uAF2D \uC0AC\uC6A9\uD574 \uC8FC\uC138\uC694! \uAC10\uC0AC\uD569\uB2C8\uB2E4!")}).catch(e=>console.log("\uC5D0\uB7EC: "+e))},get_address_id(){var t;return this.addressList.forEach(e=>{e.is_default===1&&(t=e)}),t.address_id}}}),S=n("div",{class:"text-h3"},"\uC8FC\uBB38 \uC644\uB8CC!",-1);function v(t,e,s,o,A,C){return p(),_(g,{class:"q-pa-xl"},{default:m(()=>[n("section",null,[S,f(y,{label:"\uC8FC\uBB38 \uD604\uD669 \uD655\uC778\uD558\uAE30",tag:"a",to:"/DeliveryInfo",color:"positive",outline:""})])]),_:1})}var D=d(P,[["render",v]]);export{D as default};
